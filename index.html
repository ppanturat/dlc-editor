<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="libraries/p5.min.js"></script>
    <script src="libraries/jszip.min.js"></script> 
    <script language="javascript" type="text/javascript" src="Editor.js"></script>
    <script language="javascript" type="text/javascript" src="Cutter.js"></script>
    <script language="javascript" type="text/javascript" src="Preview.js"></script>
    <script language="javascript" type="text/javascript" src="Compiler.js"></script>
    
    <link rel="stylesheet" href="style.css">

    <title>DLC Editor</title>
</head>
<body>

    <div class="container">
        
        <div id="help-icon">?</div>

        <h1>DLC Editor</h1>

        <div class="tab-nav">
            <button class="tab-link active" id="tab-unit">Unit Editor (.json/.zip)</button>
            <button class="tab-link" id="tab-sprite">Sprite Editor (.txt)</button>
            <button class="tab-link" id="tab-cutter">Sprite Cutter (.zip)</button> 
            <button class="tab-link" id="tab-compiler">DLC Compiler (.zip)</button>
        </div>

        <div class="tab-content active" id="unit-editor-content">
            <p>Use this tool to create new characters. Add one or more units, 
                then download the final <strong>config.json</strong> file 
                or <strong>.zip</strong> folder if multiple units are added.</p>
            
            <fieldset>
                <legend>Load Existing Project</legend>
                <div class="info-box">
                    The imported .json file must contain a <code>"units"</code> array to load correctly.
                </div>
                <div class="form-group" id="file-upload-group">
                    <input type="file" id="import_json" accept=".json" style="display: none;">
                    <label for="import_json" class="file-upload-label">Choose File</label>
                    <span id="file_name_display">No file selected.</span>
                </div>
            </fieldset>

            <fieldset>
                <legend>Character Details</legend>
                <div class="form-group">
                    <label for="unit_name">Name</label>
                    <input type="text" id="unit_name" placeholder="e.g., Shadow Knight">
                </div>
                <div class="form-group">
                    <label for="unit_health">Health</label>
                    <input type="number" id="unit_health" placeholder="100" min="70" max="150">
                </div>
                <div class="form-group">
                    <label for="unit_atk">Attack (ATK)</label>
                    <input type="number" id="unit_atk" placeholder="10" min="8" max="20">
                </div>
                <div class="form-group">
                    <label for="unit_def">Defense (DEF)</label>
                    <input type="number" id="unit_def" placeholder="10" min="5" max="20">
                </div>
                <div class="form-group">
                    <label for="unit_desc">Description</label>
                    <textarea id="unit_desc" placeholder="A mysterious warrior... (max 200 chars)" 
                    maxlength="200"></textarea>
                </div>
            </fieldset>

            <fieldset>
                <legend>Animation Config Selection</legend>
                <p style="font-size: 0.9em; color: #555;">Type the <strong>.txt</strong> 
                    filenames you will use for this unit.</p>
                <div class="form-group">
                    <label for="unit_idle">Idle Animation (.txt file)</label>
                    <input type="text" id="unit_idle" placeholder="e.g., NewHero_Idle.txt">
                </div>
                <div class="form-group">
                    <label for="unit_attack">Attack Animation (.txt file)</label>
                    <input type="text" id="unit_attack" placeholder="e.g., NewHero_Attack.txt">
                </div>
                <div class="form-group">
                    <label for="unit_walk">Walk Animation (.txt file)</label>
                    <input type="text" id="unit_walk" placeholder="e.g., NewHero_Walk.txt">
                </div>
                <div class="form-group">
                    <label for="unit_death">Death Animation (.txt file)</label>
                    <input type="text" id="unit_death" placeholder="e.g., NewHero_Death.txt">
                </div>
            </fieldset>

            <button type="button" id="add_unit_button">Add as New Unit</button>
            <button type="button" id="update_unit_button" class="small-button">Update Selected Unit</button>
            <button type="button" id="clear_unit_form" class="small-button">Clear Form</button>
            
            <fieldset>
                <legend>Current Units in Project</legend>
                <div class="form-group">
                    <label for="unit_list">Click a unit to load it for editing:</label>
                    <select id="unit_list" size="5"></select>
                </div>
                <button type="button" id="delete_unit_button" class="small-button">Delete Selected</button>
                <button type="button" id="delete_all_units_button" class="small-button">Delete All Units</button>
            </fieldset>

            <fieldset>
                <legend>Generated config.json</legend>
                <div class="form-group">
                    <textarea id="unit_json_output" readonly placeholder="Your 'units' array will be built here..."></textarea>
                </div>
                <button type="button" id="unit_download_button">Download config.json</button>
            </fieldset>
        </div>

        <div class="tab-content" id="sprite-editor-content">
            <p>Use this tool to create <strong>.txt</strong> config strings for the animation system.</p>

            <fieldset>
                <legend>Select Animation</legend>
                <p style="font-size: 0.9em; color: #555;">These names define the file path 
                    (e.g., /data/<strong>NewHero</strong>/<strong>Idle</strong>/NewHero_Idle_1.png)</p>
                <div class="form-group">
                    <label for="char_select">Character Folder Name</label>
                    <input type="text" id="char_select" placeholder="NewHero">
                </div>
                <div class="form-group">
                    <label for="anim_select">Animation Name</label>
                    <input type="text" id="anim_select" placeholder="Idle">
                </div>
            </fieldset>
    
            <fieldset>
                <legend>Configure Animation Files</legend>
                <div class="form-group">
                    <label for="prefix_input">Image File Prefix</label>
                    <input type="text" id="prefix_input" placeholder="NewHero_Idle_">
                </div>
                <div class="form-group">
                    <label for="ext_input">File Extension</label>
                    <select id="ext_input">
                        <option value=".png">.png</option>
                        <option value=".jpg">.jpg</option>
                        <option value=".jpeg">.jpeg</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="frame_count">Frame Count</label>
                    <input type="number" id="frame_count" placeholder="5" min="1">
                </div>
            </fieldset>
    
            <fieldset>
                <legend>Set Position and Scale</legend>
                <div class="form-group"> 
                    <label for="pos_x">Position X</label>
                    <input type="number" id="pos_x" placeholder="260">
                </div>
                <div class="form-group">
                    <label for="pos_y">Position Y</label>
                    <input type="number" id="pos_y" placeholder="170">
                </div>
                <div class="form-group">
                    <label for="scale_input">Scale</label>
                    <input type="number" id="scale_input" placeholder="3" min="1">
                </div>
            </fieldset>
    
            <fieldset>
                <legend>Generated Config</legend>
                <div class="form-group">
                    <textarea id="config_output" readonly placeholder="Config string will appear here..."></textarea>
                </div>
                <button type="button" id="download_button">Download .txt</button>
                <button type="button" id="clear_sprite_form" class="small-button">Clear</button>
            </fieldset>
            
            <fieldset>
                <legend>Live Preview</legend>
                <div class="form-group-inline">
                    <input type="checkbox" id="enable_preview_check">
                    <label for="enable_preview_check">Enable Live Preview (The images must be in 'data' folder 
                        with correct filenames and structure)</label>
                </div>
            </fieldset>
            
            <div class="preview-box" id="canvas-container">
            </div>
        </div>
        
        <div class="tab-content" id="cutter-content">
            <p>Use this tool to cut one or more spritesheets into individual frames and download them 
                as a <strong>.zip</strong> file.</p>
            
            <fieldset>
                <legend>Load Spritesheets</legend>
                <div class="info-box">
                    Select single or multiple files (e.g., Warrior_Idle_Sheet.png, 
                    Warrior_Attack_Sheet.png) organized in a folder structure.
                </div>
                <div class="form-group" id="cutter-upload-group">
                    <input type="file" id="cutter_import" accept="image/png, image/jpeg" multiple style="display: none;">
                    <label for="cutter_import" class="file-upload-label">Choose Spritesheets</label>
                    <span id="cutter_file_name">No files selected.</span>
                </div>
            </fieldset>
            
            <fieldset>
                <legend>Grid Dimensions</legend>
                <p style="font-size: 0.9em; color: #555;">How is your spritesheet arranged?</p>
                
                <div class="form-group">
                    <label for="calc_mode">Calculation Mode:</label>
                    <select id="calc_mode">
                        <option value="count">Define by Count (Rows/Cols) - recommended</option>
                        <option value="size">Define by Pixel Size (Width/Height)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="sprite_width">Sprite Width (px)</label>
                    <input type="number" id="sprite_width" placeholder="(Auto-Calculated)" readonly>
                </div>
                <div class="form-group">
                    <label for="sprite_height">Sprite Height (px)</label>
                    <input type="number" id="sprite_height" placeholder="(Auto-Calculated)" readonly>
                </div>
                <div class="form-group">
                    <label for="sprite_rows">Number of Rows</label>
                    <input type="number" id="sprite_rows" placeholder="e.g., 8">
                </div>
                <div class="form-group">
                    <label for="sprite_cols">Number of Columns</label>
                    <input type="number" id="sprite_cols" placeholder="e.g., 10">
                </div>
            </fieldset>

            <button type="button" id="cut_and_download_button">Cut & Download .zip</button>
        </div>

        <div class="tab-content" id="compiler-content">
            <p>Use this tool to package your Unit JSON, Animation Configs, and Image Zip into a single 
                <strong>Game-Ready DLC</strong> file.</p>
            
            <fieldset>
                <legend>Upload Unit Data</legend>
                <div class="info-box">
                    <strong>Description:</strong> The core data file containing stats (HP, ATK, DEF) and metadata.<br>
                    <strong>Rule:</strong> Must be the <code>Unit_Name.json</code> file downloaded from the 
                    <em>Unit Editor</em> tab.
                </div>
                <div class="form-group compiler-file-input">
                    <label for="compiler_json" class="file-upload-label">Unit File (.json)</label>
                    <input type="file" id="compiler_json" accept=".json" style="display: none;">
                    <span id="compiler_json_display">No file selected.</span>
                </div>
            </fieldset>

            <fieldset>
                <legend>Upload Animation Configs</legend>
                <div class="info-box">
                    <strong>Description:</strong> The coordinate text files that tell the game how to play animations.<br>
                    <strong>Rule:</strong> You must upload <strong>ALL</strong> config files referenced in your Unit JSON (typically Idle, Walk, Attack, and Death).
                </div>
                <div class="form-group compiler-file-input">
                    <label for="compiler_txt" class="file-upload-label">Animation Configs (.txt)</label>
                    <input type="file" id="compiler_txt" accept=".txt" multiple style="display: none;">
                    <span id="compiler_txt_display">No file selected.</span>
                </div>
            </fieldset>

            <fieldset>
                <legend>Upload Images</legend>
                <div class="info-box">
                    <strong>Description:</strong> The container for all actual image assets.<br>
                    <strong>Rule:</strong> Must be the <code>.zip</code> file generated by the 
                    <em>Sprite Cutter</em>. It must contain the internal folder structure 
                    (e.g., <code>Warrior/Idle/Warrior_Idle_1.png</code>).
                </div>
                <div class="form-group compiler-file-input">
                    <label for="compiler_zip" class="file-upload-label">Sprite Folder (.zip)</label>
                    <input type="file" id="compiler_zip" accept=".zip, .rar" style="display: none;">
                    <span id="compiler_zip_display">No file selected.</span>
                </div>
            </fieldset>

            <fieldset>
                <legend>Compile</legend>
                <div class="form-group">
                    <button type="button" id="compile_button">Compile & Download DLC</button>
                    <div id="compiler_status" style="margin-top: 10px; font-style: italic; color: #444;">
                        Waiting for inputs...</div>
                </div>
            </fieldset>
        </div>


    </div> 
    
    <div id="help-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span id="close-modal" style="float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
            <h2>DLC Editor User Guide</h2>

            <div class="guide-section">
                <h3>1. Unit Editor (JSON/ZIP)</h3>
                <p>Define your character's core stats and assign animation config files.</p>
                <ul>
                    <li><strong>Stats:</strong> Enter Name, Health, Attack, and Defense.</li>
                    <li><strong>Config Files:</strong> Enter the filenames of the text files you will generate in Tab 2 (e.g., <code>Warrior_Idle.txt</code>).</li>
                    <li><strong>Output:</strong> Click <em>Download config.json</em> to save the Unit configuration.</li>
                </ul>
            </div>

            <div class="guide-section">
                <h3>2. Sprite Editor (TXT)</h3>
                <p>Create the coordinate configuration files for your animations.</p>
                <ul>
                    <li><strong>Parameters:</strong> Define the <em>Folder</em>, <em>Animation Name</em>, and <em>File Prefix</em>.</li>
                    <li><strong>Preview:</strong> Check <em>Enable Live Preview</em> to test alignment (Requires images to be stored locally in a <code>/data/Character/Anim/</code> folder).</li>
                    <li><strong>Output:</strong> Download a separate <code>.txt</code> file for each animation (Idle, Walk, Attack, Death).</li>
                </ul>
            </div>

            <div class="guide-section">
                <h3>3. Sprite Cutter (ZIP)</h3>
                <p>Slice raw spritesheets into individual frames and package them.</p>
                <ul>
                    <li><strong>Naming Rule:</strong> Files <strong>MUST</strong> end in <code>_Sheet</code> to be auto-detected (e.g., <code>Warrior_Idle_Sheet.png</code>).</li>
                    <li><strong>Structure:</strong> The tool automatically detects the folder structure from the filename (e.g., <code>Warrior</code> folder &rarr; <code>Idle</code> folder).</li>
                    <li><strong>Grid:</strong> Select <em>Count</em> (Rows/Cols) or <em>Size</em> (Pixels) to define how frames are cut.</li>
                    <li><strong>Output:</strong> Downloads a <code>.zip</code> file containing the correctly structured image folders.</li>
                </ul>
            </div>

            <div class="guide-section">
                <h3>4. DLC Compiler (ZIP)</h3>
                <p>The final assembly line to create your Game Ready package.</p>
                <ul>
                    <li><strong>Unit JSON:</strong> Upload the <code>config.json</code> from Tab 1.</li>
                    <li><strong>Animation Configs:</strong> Upload ALL the <code>.txt</code> files created in Tab 2.</li>
                    <li><strong>Sprite Images:</strong> Upload the <code>sprites.zip</code> created in Tab 3.</li>
                    <li><strong>Action:</strong> Click <em>Compile</em> to merge everything into a final <code>DLC_Character.zip</code>.</li>
                </ul>
            </div>
        </div>
    </div>

</body>
</html>